<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tax Calculator</title>
    <link rel="stylesheet" href="styles/tax.css">
</head>
<body>
    <header>
        <h1>Tax Calculator</h1>
        <p>Calculate your tax easily and quickly.</p>
    </header>

    <main>
        <section>
            <h2>Enter Your Income and Deductions</h2>
            <form id="taxForm">
                <div class="form-group">
                    <label for="income">Income:</label>
                    <input type="number" id="income" name="income" placeholder="Enter your total income" required>
                </div>

                <div id="deductionInputs">
                    <div class="deduction-entry">
                        <label for="deduction-1">Deduction:</label>
                        <input type="number" id="deduction-1" class="deduction" placeholder="Enter deduction amount" required>
                    </div>
                </div>

                <button type="button" id="addDeduction">Add Another Deduction</button>
                <button type="submit">Calculate Tax</button>
            </form>
        </section>

        <section id="resultSection" style="display: none;">
            <h2>Result:</h2>
            <p><strong>Total Income:</strong> <span id="totalIncome"></span></p>
            <p><strong>Total Deductions:</strong> <span id="totalDeductions"></span></p>
            <p><strong>Taxable Income:</strong> <span id="taxableIncome"></span></p>
            <p><strong>Total Tax:</strong> <span id="totalTax"></span></p>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 FinFlex. All rights reserved.</p>
    </footer>

    <script>
        let deductionCount = 1;

        document.getElementById('addDeduction').addEventListener('click', () => {
            deductionCount++;
            const deductionInputs = document.getElementById('deductionInputs');

            const deductionEntry = document.createElement('div');
            deductionEntry.classList.add('deduction-entry');
            deductionEntry.innerHTML = `
                <label for="deduction-${deductionCount}">Deduction:</label>
                <input type="number" id="deduction-${deductionCount}" class="deduction" placeholder="Enter deduction amount" required>
            `;
            deductionInputs.appendChild(deductionEntry);
        });

        document.getElementById('taxForm').addEventListener('submit', async (event) => {
            event.preventDefault();

            const income = parseFloat(document.getElementById('income').value);
            const deductionInputs = document.querySelectorAll('.deduction');
            const deductions = Array.from(deductionInputs).map(input => parseFloat(input.value));

            try {
                const response = await fetch('/api/tax/calculate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ income, deductions })
                });

                const result = await response.json();

                if (response.ok) {
                    document.getElementById('totalIncome').textContent = result.income.toFixed(2);
                    document.getElementById('totalDeductions').textContent = result.totalDeductions.toFixed(2);
                    document.getElementById('taxableIncome').textContent = result.taxableIncome.toFixed(2);
                    document.getElementById('totalTax').textContent = result.tax.toFixed(2);
                    document.getElementById('resultSection').style.display = 'block';
                } else {
                    alert(result.error || 'An error occurred while calculating tax.');
                }
            } catch (error) {
                alert('Error fetching results. Please try again.');
            }
        });
    </script>
</body>
</html>
